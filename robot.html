

<head>
</head>

<body>
    <h1>Mi juego de Robi</h1>
    
    <canvas id="el-lienzo" width="500" height="500"></canvas>

    <div>
        <ul>
            <li><a href="javascript:empezarDeNuevo()">Empezar</a></li>
            <li><a href="javascript:moverAbajo()">Mover abajo</a></li>
            <li><a href="javascript:moverArriba()">Mover arriba</a></li>
            <li><a href="javascript:moverDerecha()">Mover derecha</a></li>
            <li><a href="javascript:moverIzquierda()">Mover izquierda</a></li>
            
        </ul>
    </div>
    

    <h3>Este juego ha sido desarrollado por Maider.</h3>

    
    <script>

        let canvas = document.getElementById("el-lienzo");
        let ctx = canvas.getContext("2d");
        let posFila = 1;
        let posColumna = 1;
        document.addEventListener('keydown', keyPressed);
        let listaDePosicionDeBombas = [];
        empezarDeNuevo();
        
        function pintarTablero () {

            // pintar marco
            ctx.strokeRect(0, 0, 500, 500);

            // pintar l√≠neas verticales

            let x = 50;
            for (let contador = 0; contador < 10; contador++) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, 500);
                ctx.stroke();
                ctx.closePath();

                x += 50;
            }
            // pintar lineas horizontales

            let y = 50;
            for (let contador = 0; contador < 10; contador++) {  
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(500, y);
                ctx.stroke();
                ctx.closePath();

                y += 50;
            }  
        }

        function borrarTablero() {
            ctx.clearRect(0, 0, 500, 500);
        }

        function pintarRobot() {
            ctx.font = "30px serif";
            let posY = cambiarFilaACoordenadaY(posFila);
            let posX = cambiarColumnaACoordenadaX(posColumna);
            ctx.fillText("ü§ñ", posX, posY);
        }

        function moverAbajo() {
            if (posFila < 10) {
                borrarTablero();
                pintarTablero();
                posFila = posFila + 1;
                pintarRobot(); 
                repintarBombas(); 
                comprobarSiHayBomba();
            } 
        }

        function moverArriba() {
            if (posFila > 1) {
                borrarTablero();
                pintarTablero();
                posFila = posFila - 1;
                pintarRobot(); 
                repintarBombas();  
                comprobarSiHayBomba();         
            }

        }

        function moverDerecha() {
            if (posColumna < 10) {
                borrarTablero();
                pintarTablero();
                posColumna = posColumna + 1;
                pintarRobot();
                repintarBombas();
                comprobarSiHayBomba();
            }
            
        }

        function moverIzquierda() {
            if (posColumna > 1) {
                borrarTablero();
                pintarTablero();
                posColumna = posColumna - 1;
                pintarRobot();
                repintarBombas();  
                comprobarSiHayBomba();
            }

        }
        
        function empezarDeNuevo() {
            borrarTablero();
            pintarTablero();
            posColumna = 1;
            posFila = 1;
            pintarRobot();
            listaDePosicionDeBombas = [];
            let numeroDeBombasQuePoner = 5;
            for (let contador = 0; contador < numeroDeBombasQuePoner; contador++) {
                ponerBombasRandom();
            }
        }



       // Para mover el robot con teclas

       function keyPressed (event) {
          switch (event.keyCode) {
              case 38: moverArriba(); break;
              case 40: moverAbajo(); break;
              case 37: moverIzquierda(); break;
              case 39: moverDerecha(); break;
          }
       }
       
       // Para poner bombas aleatoriamente y guardar su posicion
       

       function ponerBombasRandom() {

            let fila = Math.floor(Math.random() * 10) + 1;
            let columna = Math.floor(Math.random() * 10 + 1);

            if (columna == 1 && fila == 1) {
                ponerBombasRandom();
            } else {
                let posicionBomba = columna + ',' + fila;
                if (listaDePosicionDeBombas.includes(posicionBomba)) {
                    ponerBombasRandom();
                } else {
                    let x = cambiarColumnaACoordenadaX(columna);
                    let y = cambiarFilaACoordenadaY(fila);
                    listaDePosicionDeBombas.push(posicionBomba); 
                    ctx.font = '30px serif';
                    ctx.fillText('üí£', x, y);
                }
                
            }       
       }
       
       function cambiarFilaACoordenadaY(unaFila) {
            return unaFila * 50 -20;
       }

       function cambiarColumnaACoordenadaX(unaColumna) {
            return unaColumna * 50 -43;
       }

       function repintarBombas() {
           for (i = 0; i < listaDePosicionDeBombas.length; i++) {
                let coordenadasSeparadas = listaDePosicionDeBombas[i].split(',');
                let x = cambiarColumnaACoordenadaX(coordenadasSeparadas[0]);
                let y = cambiarFilaACoordenadaY(coordenadasSeparadas[1]);
                ctx.font = '30px serif';
                ctx.fillText('üí£', x, y);
            }
       }   

       function comprobarSiHayBomba() {
            for(let bomba of listaDePosicionDeBombas) {
                let coordenadasSeparadas = bomba.split(',');
                if (posColumna == coordenadasSeparadas[0] && posFila == coordenadasSeparadas[1]) {
                    ctx.font = "30px serif";
                    let x = cambiarColumnaACoordenadaX(coordenadasSeparadas[0]);
                    let y = cambiarFilaACoordenadaY(coordenadasSeparadas[1]);
                    ctx.fillText("üí•", x, y);
                    alert("GAME OVER");

                    // retornamos para que no siga buscando otras bombas (no debe haber m√°s)
                    return
                }
            }
        }
        
    </script>

</body>